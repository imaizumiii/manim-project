# アーキテクチャドキュメント

## プロジェクト構造

```
manim-lib/
├── videos/                    # 各動画のスクリプト
│   ├── video_001_intro.py
│   ├── video_002_topic1.py
│   └── ...
│
├── lib/                       # 再利用可能なコードライブラリ
│   ├── __init__.py
│   ├── config.py             # グローバル設定
│   │   ├── THEME_COLORS      # テーマカラー定義
│   │   ├── RESOLUTION        # 解像度設定
│   │   ├── FPS               # フレームレート
│   │   └── パス設定          # アセットへのパス
│   │
│   ├── styles.py             # スタイル設定
│   │   ├── フォント設定
│   │   ├── 数式スタイル
│   │   └── アニメーション設定
│   │
│   ├── scenes/               # シーン構成のテンプレート
│   │   ├── __init__.py
│   │   ├── base_scene.py     # ベースシーンクラス
│   │   │   ├── ロゴ表示（右下固定）
│   │   │   ├── BGM管理（フェードイン/アウト）
│   │   │   └── 共通セットアップ
│   │   ├── intro_scene.py    # イントロシーン（必要に応じて）
│   │   └── outro_scene.py    # アウトロシーン（必要に応じて）
│   │
│   ├── objects/              # カスタムオブジェクト
│   │   ├── __init__.py
│   │   ├── logo.py           # ロゴ表示オブジェクト
│   │   ├── math_objects.py   # 数式関連のカスタムオブジェクト
│   │   └── ...
│   │
│   └── utils/                # ユーティリティ関数
│       ├── __init__.py
│       └── audio.py          # BGM管理ユーティリティ
│
├── assets/                    # 静的ファイル
│   ├── logo/
│   │   └── logo.png          # ロゴ画像
│   ├── music/
│   │   └── bgm.mp3            # BGMファイル
│   └── fonts/                # カスタムフォント（必要なら）
│
├── output/                    # レンダリング出力（.gitignore対象）
│   ├── videos/
│   └── images/
│
└── docs/                      # ドキュメント
    ├── README.md
    ├── ARCHITECTURE.md
    └── PROJECT.md
```

## 設計思想

### 1. 再利用性の重視

- 共通機能は `lib/` ディレクトリに集約
- 各動画スクリプトは `BaseScene` を継承して一貫性を保つ
- 設定は `config.py` に一元管理

### 2. 関心の分離

- **設定**: `config.py` - テーマカラー、解像度など
- **スタイル**: `styles.py` - 視覚的なスタイル定義
- **シーン**: `scenes/` - シーン構成のテンプレート
- **オブジェクト**: `objects/` - 再利用可能なオブジェクト
- **ユーティリティ**: `utils/` - ヘルパー関数

### 3. 拡張性

- 新しいカスタムオブジェクトは `objects/` に追加
- 新しいシーンテンプレートは `scenes/` に追加
- 設定の追加は `config.py` に集約

## 主要コンポーネント

### BaseScene

すべての動画シーンの基底クラス。以下の機能を提供：

- **ロゴ表示**: 全シーンの右下にロゴを常時表示
- **BGM管理**: 全編でフェードイン/アウトするBGMを自動適用
- **背景色設定**: テーマカラーに基づいた背景色
- **共通セットアップ**: 各シーンで必要な初期化処理

### 設定管理 (config.py)

グローバル設定を一元管理：

```python
THEME_COLORS = {
    'primary': '#1E88E5',
    'secondary': '#43A047',
    'accent': '#FFB300',
    'background': '#263238',
    'text': '#FFFFFF',
}

RESOLUTION = "1080p60"
FPS = 60
```

### ロゴ表示システム

- 全シーンの右下に固定表示
- 透明度やサイズを調整可能
- `objects/logo.py` で管理

### BGM管理システム

- 全編でBGMを再生
- フェードイン/アウトを自動処理
- `utils/audio.py` で管理

## データフロー

```
動画スクリプト (videos/*.py)
    ↓
BaseScene を継承
    ↓
config.py から設定を読み込み
    ↓
lib/ のコンポーネントを使用
    ↓
assets/ からアセットを読み込み
    ↓
Manim でレンダリング
    ↓
output/ に出力
```

## 拡張ガイドライン

### 新しいカスタムオブジェクトを追加する

1. `lib/objects/` に新しいファイルを作成
2. Manimのオブジェクトを継承またはラップ
3. `lib/objects/__init__.py` にエクスポート
4. 動画スクリプトでインポートして使用

### 新しいシーンテンプレートを追加する

1. `lib/scenes/` に新しいファイルを作成
2. `BaseScene` を継承
3. テンプレートとなる `construct()` メソッドを実装
4. 必要に応じて他の動画で継承して使用

### 設定を追加する

1. `lib/config.py` に新しい設定を追加
2. 必要に応じて `BaseScene` で使用
3. ドキュメントに追加内容を記載

## ベストプラクティス

1. **動画ごとにファイルを分ける**: `videos/` 内で各動画を独立したファイルに
2. **BaseSceneを継承**: 一貫性を保つため必ず `BaseScene` を使用
3. **設定はconfig.pyに集約**: ハードコードを避ける
4. **再利用可能なコードはlib/に**: 2回以上使うコードはライブラリ化
5. **アセットはassets/に配置**: 静的ファイルは必ず `assets/` に

## パフォーマンス考慮事項

- 低品質プレビュー（`-ql`）で開発中の確認を行う
- 最終レンダリングのみ高品質（`-qh`）を使用
- 大きなアセットファイルは必要最小限に
- 不要なアニメーションは避ける
